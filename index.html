---
layout: empty
permalink: /
title: "TradeAudit App for Fintwit"
sitemap: true
author_profile: false
---

<h1 class="display-5 fw-bold text-center">Stock Tracking for Financial Twitter</h1>

<span class="lead mb-4" style="text-align: justify;text-justify: inter-word;">
  <span class="text-center">
    Social media <a href="https://twitter.com/hashtag/fintwit?src=hashtag_click" target="_blank" class="fw-bold">#fintwit</a> is 
    full of <span class="fw-bold">"financial professionals"</span> and <span class="fw-bold">"macro analysts"</span>.
  </span>
  They curate twitter feeds to promote successful trading but hide losses by deleting tweets and posting misinformation.
  Do your due diligence and audit trading records before you invest your time and money.
</span>

<script type="module">
import {LitElement, html, svg, css} from 'https://cdn.jsdelivr.net/gh/lit/dist@2/core/lit-core.min.js';

export class PieChart extends LitElement {
  static properties = {
      positive: { type: Number },
      negative: { type: Number },
      size: { type: Number },
  };

  render() {

    function getCoordinatesForPercent(percent) {
      const x = Math.cos(2 * Math.PI * percent);
      const y = Math.sin(2 * Math.PI * percent);
      return [x, y];
    }

    const arr = [
      { percent: this.positive ?? 0, color: '#538600' },
      { percent: this.negative ?? 0, color: '#9f003e' },
    ];

    let cumulativePercent = 0;

    const slices = arr.map(slice => {
      // destructuring assignment sets the two variables at once
      const [startX, startY] = getCoordinatesForPercent(cumulativePercent);

      // each slice starts where the last slice ended, so keep a cumulative percent
      cumulativePercent += slice.percent;

      const [endX, endY] = getCoordinatesForPercent(cumulativePercent);

      // if the slice is more than 50%, take the large arc (the long way around)
      const largeArcFlag = slice.percent > .5 ? 1 : 0;

        // create an array and join it just for code readability
      const pathData = [
        `M ${startX} ${startY}`, // Move
        `A 1 1 0 ${largeArcFlag} 1 ${endX} ${endY}`, // Arc
      ].join(' ');

      return svg`<path d="${pathData}" stroke="${slice.color}" stroke-width="0.45" fill="transparent"/>`;
    })

    const total = this.positive + this.negative;
    const percent = total == 0 ? 0 : (this.positive / total * 100);
    const text = Math.round(percent) + '%';
    const textX = text.length == 4 ? -16.5 : (text.length == 3 ? -12 : -7);
    const size = this.size ?? 64;

    return svg`
       <svg xmlns="http://www.w3.org/2000/svg" viewBox="-1.3 -1.3 2.6 2.6" height="${size}" width="${size}">
         <style>
            .small {
              font: bold 13px sans-serif;
              color: black;
            }
         </style>
         ${slices}
         <text class="small" transform="scale(0.043, 0.043)" x="${textX}" y="4">${text}</text>
       </svg>
    `;
  }
}
customElements.define('pie-chart', PieChart);

export class UserSummary extends LitElement {
  static properties = {
      usersummaries: { type: Array, state: true, attribute: false },
      selectedStockSymbol: { type: String, state: true },
      height: { type: Number },
  };
  
  static styles = css`
    .showchart:hover, .showchart:focus {
        filter: invert(27%) sepia(51%) saturate(2878%) hue-rotate(246deg) brightness(104%) contrast(97%);
    }
  `;
  
  static isProtected = html`<img src="https://tradeaudit.app/assets/OOjs_UI_icon_lock.svg" width="18" height="18" style="margin-bottom: 4pt" alt="Protected">`;
  static isVerified = html`<img src="https://tradeaudit.app/assets/Twitter_Verified_Badge.svg" width="18" height="18" style="margin-bottom: 4pt" alt="Verified">`;
  static humanNumber(num){
    function intlFormat(num){
      return new Intl.NumberFormat().format(Math.floor(num*10)/10);
    }
    if(num >= 1000000)
      return intlFormat(num/1000000)+'M';
    if(num >= 1000)
      return intlFormat(num/1000)+'k';
    return intlFormat(num);
  }
  
  render() {
    const height = this.height ?? 64;
    return html`
       <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
  integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
       <link rel="preload" href="https://tradeaudit.app/assets/finance.svg" as="image" />
       <ul class="list-group" id="stock-ul" style="max-width:1024px;margin:auto;">
            ${(this.usersummaries ?? []).map(
              (item) => {
                const profileUrl = "https://cf.tradeaudit.app/" + item.twitterProfileUrl.substring(22);
                return html`
                <li class="list-group-item" style="display:flex;align-items:center;">
                  <a style="all:unset;cursor: pointer;" href="https://twitter.com/${item.twitterDisplayName}" target="_blank" title="Open on Twitter">
                    <div style="display:flex">
                        <img src="${profileUrl}" style="width:${height}px;height:${height}px;border-radius:50%;"/>
                        <div style="text-align:left;padding-left:12px;margin-top:auto;margin-bottom:auto;">
                            <h5 class="card-title">${item.twitterUserName}${item.isProtected ? UserSummary.isProtected : null}${item.isVerified ? UserSummary.isVerified : null}</h5>
                            <h6 class="card-subtitle text-muted">@${item.twitterDisplayName}</h6>
                            <span>${UserSummary.humanNumber(item.followerCount)} Followers</span>
                        </div>
                    </div>
                  </a>
                  <div style="flex-grow:1" class="card-text text-end">
                      <div style="font-weight:bold">${item.conversationCount} Trade Conversations</div>
                      ${item.stocks.map(
                          (stock) => {
                              const selected = this.selectedStockSymbol == stock.symbol ? "fw-bold" : "";
                              return html`<span class="card-link text-muted ${selected}" style="padding-left:4px;padding-right:4px">${stock.symbol}</span>`
                          }
                      )}
                  </div>
                  ${
                    (this.selectedStockSymbol != null) ? html`<a href="https://tradeaudit.app/user?twitter=${item.twitterUserName}&symbol=${this.selectedStockSymbol}">
                        <img src="https://tradeaudit.app/assets/finance.svg" class="showchart" width="60" height="60" alt="Open user conversation chart">
                    </a>` : html`<div style="width:60px"></div>`
                  }
                  <pie-chart size="${height}" positive="${item.positiveRatingPercent}" negative="${item.negativeRatingPercent}"></pie-chart>
                </li>`
              }
            )}
        </ul>
    `;
  }
}
customElements.define('user-summary', UserSummary);
    
export class StockToolbar extends LitElement {
  static properties = {
      stocks: { type: Array, state: true },
      selectedStockSymbol: { type: String, state: true },
      isTop: { type: Boolean, state: true },
      usersummaries: { type: Array, state: true, attribute: false },    
  };

  constructor() {
    super();
    this.stocks = [];
    this.isTop = true;

    var url = 'https://api.tradeaudit.app/web/stocks/top';

    // Making our request
    fetch(url, { method: 'GET' })
        .then(Result => Result.json())
        .then(string => {
            console.log(string);
            this.stocks = string.stocks;
            this.requestUpdate();
        })
    .catch(errorMsg => { console.log(errorMsg); });

    this.toggleSelected(null);
  }

  render() {
    return html`
       <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
  integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
        <div class="input-group mb-3" role="group" aria-label="User Sort" style="margin:auto;justify-content:center;">
            <button
                @click=${() => this.toggleSort(true)}
                class="btn btn-outline-secondary ${this.isTop ? 'active' : ''}" type="button"
                title="Top Users" data-bs-toggle="tooltip" data-bs-placement="top"
            >ðŸ’° Top Users</button>
            <button
                @click=${() => this.toggleSort(false)}
                class="btn btn-outline-secondary ${this.isTop ? '' : 'active'}" type="button"
                title="Bottom Users" data-bs-toggle="tooltip" data-bs-placement="top"
            >ðŸ¤¡ Bottom Users</button>
        </div>
        <div class="input-group mb-3" role="group" aria-label="Stocks" style="margin:auto;justify-content:center;">
            ${this.stocks.map(
              (item) => html`
                <button
                    @click=${() => this.toggleSelected(item.symbol)}
                    class="btn btn-outline-secondary ${item.symbol == this.selectedStockSymbol ? 'active' : ''}" type="button"
                    title="${item.name}" data-bs-toggle="tooltip" data-bs-placement="top"
                >
                    ${item.symbol}
                </button>`
            )}
        </div>
        <user-summary height="80" .selectedStockSymbol=${this.selectedStockSymbol} .usersummaries=${this.usersummaries}></user-summary>
    `;
  }

  toggleSort(isTop) {
    if(this.isTop != isTop){
      this.isTop = isTop;
      this.fetchUserSummaries();
    }
  }
  
  toggleSelected(stockSymbol) {
    if(this.selectedStockSymbol == stockSymbol){
      this.selectedStockSymbol = null;
    }else{
      this.selectedStockSymbol = stockSymbol;
    }
    this.fetchUserSummaries();
  }
  
  fetchUserSummaries(){
    const self = this;

    var url = 'https://api.tradeaudit.app/web/users/' + (this.isTop ? 'top' : 'bottom');
    
    // Making our request
    fetch(url, { method: 'GET' })
        .then(Result => Result.json())
        .then(string => {
            if(this.selectedStockSymbol != null){
                self.usersummaries = string.users.filter(user => user.stocks.find(stock => stock.symbol === this.selectedStockSymbol) != null);
            }else{
                self.usersummaries = string.users;
            }
            self.requestUpdate();
        })
    .catch(errorMsg => { 
      console.log(errorMsg);
      self.requestUpdate();
    });
  }
}
customElements.define('stock-toolbar', StockToolbar);
</script>

<stock-toolbar></stock-toolbar>
  
